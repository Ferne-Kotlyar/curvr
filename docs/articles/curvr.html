<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to curvr • curvr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to curvr">
<meta property="og:description" content="curvr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">curvr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/curvr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to curvr</h1>
            
      
      
      <div class="hidden name"><code>curvr.Rmd</code></div>

    </div>

    
    
<div id="abstract" class="section level4">
<h4 class="hasAnchor">
<a href="#abstract" class="anchor"></a>Abstract</h4>
<ol style="list-style-type: decimal">
<li><p>Flower-pollinator curvature as viewed from the side (dorsiventral plane) has been a trait of special interest through the post-Darwin era of pollination ecology. However, within pollination ecology there are at least four metrics in use with few references to their origins or the meaning of the associated units. <span class="citation">(Boehm and Cronk, <a href="#ref-boehm_2020" role="doc-biblioref">2020</a>)</span> recently suggested clarifying the defintion of curvature by using concepts of differential geometry.</p></li>
<li><p>This paper introduces an R package <code>curvr</code> for computing curvature from curves fitted to landmarks placed on images of specimens. <code>curvr</code> is designed to take inputs from <code>Momocs</code>, an open-source toolkit for 2D morphometrics in R. I outline possible advances to the curve-fitting protocol that may subsequently improve estimations of total curvature.</p></li>
<li><p>Using Darwin’s finches (Geospizinae) as an example, we show how analyzing bill shape for curvature can compliment morphometric analyses.</p></li>
<li>
</ol>
<div style="page-break-after: always;"></div>
<p>Sections: 1. Why curvature is interesting in plant-poll systems, intro to geometric morphometrics, and how curvature needs to be analysed seprately. 2. The curvr package (algorithims) 3. Applications</p>
</div>
<div id="introduction" class="section level4">
<h4 class="hasAnchor">
<a href="#introduction" class="anchor"></a>1. Introduction</h4>
<p>The curvature of flowers and pollinator mouthparts (eg bird bills) is a widespread trait contributing to morphological diversity in the angiosperms and their pollinators. The evolutionary ecology and history of measuring curvature was recently reviewed in <span class="citation">(Boehm and Cronk, <a href="#ref-boehm_2020" role="doc-biblioref">2020</a>)</span>. To briefly summarize; the curvature of floral tubes as viewed from the dorsiventral plane (hereafter ‘curvature’) has long been recognized as morphological feature that contributes to floral isolation <span class="citation">(sensu <span class="citeproc-not-found" data-reference-id="grant_1949"><strong>???</strong></span>)</span>. As curvature represents one of three spatial dimensions in which floral diversity can evolve (in addition to width and length), it is likely to play a role in floral diversification <span class="citation">(Kay and Sargent, <a href="#ref-kay_2009" role="doc-biblioref">2009</a>; Armbruster and Muchhala, <a href="#ref-armbruster_2009" role="doc-biblioref">2009</a>; Vamosi et al., <a href="#ref-vamosi_2018" role="doc-biblioref">2018</a>)</span>. Similarly, pollinators that specialize on curved flowers evolve curved mouthparts, contributing to morphological diversification of these clades <span class="citation">(<span class="citeproc-not-found" data-reference-id="weinstein_2017"><strong>???</strong></span>; <span class="citeproc-not-found" data-reference-id="maruyama_2018"><strong>???</strong></span>)</span>. Thus flower-pollinator curvature has been of special interest to pollination ecologists, resulting in over 40 studies since the late 1970’s. Among these studies <span class="citation">(Boehm and Cronk, <a href="#ref-boehm_2020" role="doc-biblioref">2020</a>)</span> identified 4 modes of defining and quantifying curvature, in addition to the more general approach of quantifying shape via geometric morphometrics. Despite the many approaches to measuring curvature, there is a lack of consensus as to what curvature means, how to interpret their units, and how varying methods could or should be compared. To this end, <span class="citation">(Boehm and Cronk, <a href="#ref-boehm_2020" role="doc-biblioref">2020</a>)</span> proposed a revised definition of curvature that directly borrowed from the mathematical literature, including an interpretation of accompanying units.</p>
<p>Curvature, as defined in differential geometry, is the rate of directional change of the tangent, <span class="math inline">\(\mathbf{T}\)</span>, with respect to arc length, <span class="math inline">\(s\)</span>, along the curve:</p>
<p><span class="math display">\[\kappa = \frac{d \mathbf{T}}{ds}\]</span></p>
<p>For a straight line, the direction of the tangent is constant and therefore, curvature is zero. For a curved line, the tangent may drastically change direction from point to point, resulting in some non-zero value of curvature. Integrating point-wise curvature gives the <em>total curvature</em> of a curve:</p>
<p><span class="math display">\[\kappa_{total} = \int_{0}^{s_{max}} \kappa \; ds\]</span></p>
<p>At some arbitrary point <span class="math inline">\(i\)</span>, curvature (<span class="math inline">\(\kappa_i\)</span>) is reported as <span class="math inline">\(degrees\)</span> per unit length. For example, if measurements have been made at every millimeter along the curve, point-wise curvature is reported as <span class="math inline">\(degrees \cdot mm^{-1}\)</span>. <em>Total curvature</em>, the sum of total tangent rotations across the length of the curve, is expressed as <span class="math inline">\(degrees\)</span>. Further techincal details can be found in <span class="citation">(Boehm and Cronk, <a href="#ref-boehm_2020" role="doc-biblioref">2020</a>)</span> and references therein.</p>
<p>The R package <code>curvr</code> was created to demonstrate the utility of this revised definition of curvature - it calculates point-wise curvature from curves fitted to landmarked specimens. This package is designed to work alongside common protocols in geometric morphometrics (GM) - the study of shape and its covariance with associated or causal variables <span class="citation">(Bookstein, <a href="#ref-bookstein_1991" role="doc-biblioref">1991</a>; MacLeod, <a href="#ref-macleod_2002" role="doc-biblioref">2002</a>)</span>. While relevant concepts from GM are outlined here, the curious reader is recommended the concise introduction to the topic by Webster and Sheets <span class="citation">(<span class="citeproc-not-found" data-reference-id="webster_2010"><strong>???</strong></span>)</span>, and for detailed reading, Zelditch et al <span class="citation">(<span class="citeproc-not-found" data-reference-id="zelditch_2004"><strong>???</strong></span>)</span>.</p>
<p>Geometric morphometrics aims at quantifying shape, ie the geometric information remaining after after specimen size, location, and orientation have been accounted for <span class="citation">(Kendall, <a href="#ref-kendall_1977" role="doc-biblioref">1977</a>; Bookstein, <a href="#ref-bookstein_1991" role="doc-biblioref">1991</a>)</span>. A typical GM protocol begins with assigning landmarks to the specimen. Landmarks are points on a specimen that are topologically or biologically homologous <span class="citation">(Bookstein, <a href="#ref-bookstein_1991" role="doc-biblioref">1991</a>)</span>. Generally, the more landmarks assigned to a specimen, the more information about its shape that has been captured. In a comparative study, landmarked specimens are scaled, translated, and rotated to remove features not contributing to shape <span class="citation">(<span class="citeproc-not-found" data-reference-id="rohlf_1990_b"><strong>???</strong></span>)</span>. In <em>outline-based</em> GM, shape functions are fit to the landmarks, for example using the tangent angle function <span class="citation">(<span class="citeproc-not-found" data-reference-id="zahn_1972"><strong>???</strong></span>)</span>. In <em>landmark-based</em> GM, the set of landmarks are taken together as a ‘landmark configuration’ and exist in a multidimensional shape space, defined by the number of landmarks used, and the spatial dimensions in which they were assigned <span class="citation">(2D or 3D, Kendall, <a href="#ref-kendall_1984" role="doc-biblioref">1984</a>)</span>. In both approaches, shape has been summarised as a single variable so that useful statistical procedures can be applied; most GM protocols involve principal components analysis (PCA) of shape variables, enabling the major axes of shape variation to be calculated and plotted in PCA ‘shape space’ <span class="citation">(MacLeod, <a href="#ref-macleod_2002" role="doc-biblioref">2002</a>)</span>.</p>
<p>Inspection of deformation grids [XXX] or end-member specimens <span class="citation">(MacLeod, <a href="#ref-macleod_2002" role="doc-biblioref">2002</a>)</span> plotted onto these axes are suggestive of the geometric features contributing to shape variation (eg curvature). The role of <code>curvr</code> is to re-purpose the landmark assignments used in the GM analysis to calculate <em>total curvature</em> from each specimen. By explicitly quantifying curvature, the investigator can empircally test the contribution of curvature to shape variation along some principal axis of interest. In the following section the algorithims for computing point-wise curvature are described, followed by a demonstration of its utility alongside a typical GM analysis.</p>
<div style="page-break-after: always;"></div>
</div>
<div id="the-curvr-package" class="section level4">
<h4 class="hasAnchor">
<a href="#the-curvr-package" class="anchor"></a>2. The <code>curvr</code> package</h4>
<p>Computing point-wise and total curvature necessitates fitting a curve to the specimen of interest. Fortunately, the landmarks used in a GM protocol can be re-purposed for regressing curves to the specimen. However, in GM, landmarks are placed throughout the entire specimen to quantify shape. Quantifying curvature typically implies a segment of the shape that is of particular interest, therefore the landmarks used for curvature analysis will be a subset of those used in the GM protocol.</p>
<p>The <code>curvr</code> package can be used alongside a typical GM protocol where specimens have been digitally landmarked using eg tpsDig <span class="citation">(Rohlf, <a href="#ref-rohlf_2015" role="doc-biblioref">2015</a>)</span>, <code>Momocs</code> <span class="citation">(Bonhomme et al., <a href="#ref-bonhomme_2014" role="doc-biblioref">2014</a>)</span>, or <code>geomorph</code> <span class="citation">(<span class="citeproc-not-found" data-reference-id="adams_2013"><strong>???</strong></span>)</span>. Landmarked specimens with <span class="math inline">\(xy\)</span> coordinates can then be fitted with polynomial curves using <code><a href="https://rdrr.io/pkg/Momocs/man/npoly.html">Momocs::npoly</a></code> or <code><a href="https://rdrr.io/pkg/Momocs/man/opoly.html">Momocs::opoly</a></code>. The output of either function is a list-object (XXX) with the first element containing the polynomial coefficients in ascending order of degrees. <code><a href="../reference/total_curvature.html">curvr::total_curvature</a></code> takes these lists as inputs, extracts the coefficients and constructs formulas (XXX) that are passed to <code><a href="https://rdrr.io/r/stats/deriv.html">stats::deriv3</a></code> for computing first and second derivatives. Before point-wise curvature is estimated from the derivatives, the polynomial function is parameterized by arc length. The advantage of this step is that curvature can be calculated at even increments of arc length, <span class="math inline">\(s\)</span>. The polynomial is parameterized by arc length by first splitting the curve into sub-curves of incrementally increasing proportions of total length, from 0 to 1. For example, a curve split into 10 parts would have 10 sub-curves with arc length calculated as <span class="math inline">\(0.1(s)\)</span>, <span class="math inline">\(0.2(s)\)</span>, …, <span class="math inline">\(1.0(s)\)</span>. Each sub-curve has a lower <span class="math inline">\(x\)</span> bound of known value (the lower bound of the original polynomial). The upper <span class="math inline">\(x\)</span> bound (of each sub-surve) is unknown. The root-finding function <code><a href="https://rdrr.io/r/stats/uniroot.html">stats::uniroot</a></code> solves for the unknown upper <span class="math inline">\(x_i\)</span> value, <span class="math inline">\(u_i\)</span>, for each <span class="math inline">\(i\)</span> sub-curve:</p>
<p><span class="math display">\[f(u_i) = pracma::arclength(polynomial, lower $x$ bound, $u_i$)$length \]</span></p>
<p>The result is a vector of <span class="math inline">\(x\)</span> values that correspond to even increments of arc length along the polynomial. We then use the gradient (first derivaties, <span class="math inline">\(y'\)</span>) and Hessian matricies (second derivatives, <span class="math inline">\(y''\)</span>) to calculate point-wise <span class="math inline">\(\kappa\)</span> at every position <span class="math inline">\(x_i\)</span>:</p>
<p><span class="math display">\[\kappa_i = \frac{|y''|}{(1+y'^2)^{\frac{3}{2}}}\]</span></p>
<p>Although written differently than the equation for curvature stated in the introduction, this definition is equivalent (parameterized? read wikipedia article…).</p>
<p>Finally, the point-wise curvature measurements are summed and converted from radians to degrees. The output of <code><a href="../reference/total_curvature.html">curvr::total_curvature()</a></code> is <em>total curvature</em> as defined above.</p>
<p>Before submitting <code>Momocs</code> polynomials to <code>curvr</code>, the user first needs to inspect their list-object and extract the lower and upper <span class="math inline">\(x\)</span> bounds of their polynomial. These bounds are entered as the <code>x_range</code> parameter of <code><a href="../reference/total_curvature.html">curvr::total_curvature()</a></code>. Additionally, the user needs to specify the number of subdivisions made to their curve(s). Greater subdivisions more completely sample the curve, but increases computing time. It is recommended to use subdivisions on the order of 500 or greater.</p>
<p>In its current form, <code>curvr</code> accepts outputs from the R package <code>Momocs</code> <span class="citation">(Bonhomme et al., <a href="#ref-bonhomme_2014" role="doc-biblioref">2014</a>)</span>, specifically polynomial objects fitted to landmarked specimens. Because polynomials will often miss local curvature features, the incoming version of <code>curvr</code> will adopt more sophisticated curve-fitting procedures from the field of outline-based morphometrics (discussed further in final section).</p>
</div>
<div id="applications" class="section level4">
<h4 class="hasAnchor">
<a href="#applications" class="anchor"></a>3. Applications</h4>
<p>In this section, we will illustrate the utility of quantifying curvature along a typical analysis of morphometric data. Here, we will test whether bill curvature is correlated with variation along a principal component of shape space. Morphometric has been kindly provided by Navalon et al (2020) - their study examined skull and bill morphology as integrated or decoupled phenotypes. One of the results from Navalon et al (2020, p.17) states:</p>
<p>-Read: Navalon et al 2019 (Nature E&amp;E) -Recreate GM analysis -complement with curvature analysis</p>
<p>Section: shortcoming of using polynomials. Suggest alternate methods. Table 1. Functions available in <code>curvr</code> version 0.1.0 for computing point-wise curvature</p>
<p>Columns: Function, Method, Reference</p>
<p>In GM analyses,</p>
<p>We recommend using at least 800 subdivisions:</p>
<pre><code>x &lt;- 1:10
y &lt;- x^2
mdat &lt;- matrix(c(x,y), nrow=10, ncol=2)
my_poly &lt;- Momocs::npoly(mdat, 2)
  
K5     &lt;- totalK(c(0,1), my_poly, 5)
K20    &lt;- totalK(c(0,1), my_poly, 20)
K50    &lt;- totalK(c(0,1), my_poly, 50)
K200   &lt;- totalK(c(0,1), my_poly, 200)
K800   &lt;- totalK(c(0,1), my_poly, 800)
K2000  &lt;- totalK(c(0,1), my_poly, 2000)
K10000 &lt;- totalK(c(0,1), my_poly, 10000)

subdiv &lt;- c(5, 20, 50, 200, 800, 2000, 10000)
K_values &lt;- c(55.34299, 46.00986, 44.1399, 43.20422, 42.97015, 42.92333, 42.89837)

sub_vs_K &lt;- matrix(nrow=7, ncol=2)
sub_vs_K[,1] &lt;- subdiv
sub_vs_K[,2] &lt;- K_values

sK_tbl &lt;- as_tibble(sub_vs_K)
ggplot(data=sK_tbl, aes(V1, V2)) + geom_point()

</code></pre>
<p>example short: <a href="https://besjournals.onlinelibrary.wiley.com/doi/epdf/10.1111/2041-210X.13385" class="uri">https://besjournals.onlinelibrary.wiley.com/doi/epdf/10.1111/2041-210X.13385</a> <a href="https://besjournals.onlinelibrary.wiley.com/doi/epdf/10.1111/2041-210X.13293" class="uri">https://besjournals.onlinelibrary.wiley.com/doi/epdf/10.1111/2041-210X.13293</a></p>
<p>pgs 184, 186o <a href="https://ebookcentral.proquest.com/lib/ubc/reader.action?docID=422384&amp;ppg=18" class="uri">https://ebookcentral.proquest.com/lib/ubc/reader.action?docID=422384&amp;ppg=18</a></p>
</div>
<div id="references" class="section level4 unnumbered">
<h4 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h4>
<div id="refs" class="references">
<div id="ref-armbruster_2009">
<p>Armbruster, W.S., and Muchhala, N. (2009). Associations between floral specialization and species diversity: Cause, effect, or correlation? Evolutionary Ecology <em>23</em>, 159–179.</p>
</div>
<div id="ref-boehm_2020">
<p>Boehm, M.M.A., and Cronk, Q.C.B. (2020). Plant-pollinator specialization: Origin and measurement of curvature. The American Naturalist <em>100</em>, 164–170.</p>
</div>
<div id="ref-bonhomme_2014">
<p>Bonhomme, V., Picq, S., Gaucherel, C., and Claude, J. (2014). Momocs: Outline analysis using R. Journal of Statistical Software <em>56</em>, 1–24.</p>
</div>
<div id="ref-bookstein_1991">
<p>Bookstein, F.L. (1991). Morphometric tools for landmark data: geometry and biology (Cambridge University Press).</p>
</div>
<div id="ref-kay_2009">
<p>Kay, K.M., and Sargent, R.D. (2009). The role of animal pollination in plant speciation: Integrating ecology, geography, and genetics. Annual Review of Ecology, Evolution, and Systematics <em>40</em>, 637–656.</p>
</div>
<div id="ref-kendall_1977">
<p>Kendall, D.G. (1977). The diffusion of shape. Advances in Applied Probability <em>9</em>, 428–430.</p>
</div>
<div id="ref-kendall_1984">
<p>Kendall, D.G. (1984). Shape manifolds, Procrustean metrics, and complex projective spaces. Bulletin of the London Mathematical Society <em>16</em>, 81–121.</p>
</div>
<div id="ref-macleod_2002">
<p>MacLeod, N. (2002). Geometric morphometrics and geological shape-classification systems. Earth-Science Reviews <em>59</em>, 27–47.</p>
</div>
<div id="ref-rohlf_2015">
<p>Rohlf, F.J. (2015). The tps series of software. Hystrix <em>26</em>.</p>
</div>
<div id="ref-vamosi_2018">
<p>Vamosi, J.C., Magallón, S., Mayrose, I., Otto, S.P., and Sauquet, H. (2018). Macroevolutionary patterns of flowering plant speciation and extinction. Annual Review of Plant Biology <em>69</em>, 685–706.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mannfred Masahiro Asada Boehm.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
